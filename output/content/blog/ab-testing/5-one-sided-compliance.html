<!DOCTYPE html><html class="scroll-smooth" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Understanding One-Sided Noncompliance in Experiments</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><link href="https://fonts.googleapis.com" rel="preconnect"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/><style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f7f4; color: #334155; }
        .nav-link { transition: color 0.2s; }
        .nav-link:hover { color: #3b82f6; }
        .stat-card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1); }
        .tab { cursor: pointer; padding: 0.75rem 1rem; border-bottom: 2px solid transparent; }
        .tab.active { color: #3b82f6; border-color: #3b82f6; font-weight: 600;}
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .strata-card { transition: all 0.5s ease-in-out; }
        .strata-card.disabled { opacity: 0.3; filter: grayscale(100%); transform: scale(0.95); }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .tooltip { position: relative; display: inline-block; cursor: pointer; }
        .tooltip .tooltiptext { visibility: hidden; width: 220px; background-color: #334155; color: #fff; text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.875rem; font-weight: 400; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    </style></head><body class="antialiased"><header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm"><nav class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center"><span class="font-bold text-xl text-slate-700">Noncompliance Explainer</span></div><div class="hidden md:block"><div class="ml-10 flex items-baseline space-x-4"><a class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600" href="#problem">The Problem</a><a class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600" href="#framework">The Framework</a><a class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600" href="#solution">Interactive Solution</a><a class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600" href="#pitfalls">Pitfalls</a><a class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600" href="#design">Design Principles</a></div></div></div></nav></header><main><section class="py-16 sm:py-20 lg:py-24 bg-white" id="intro"><div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center"><h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-slate-800">The Reality of Imperfect Experiments</h1><p class="mt-6 max-w-3xl mx-auto text-lg sm:text-xl text-slate-600">Ideal experiments see perfect adherence to rules.  Real-world participants often deviate. This mismatch, termed **noncompliance**, presents a key hurdle. This guide focuses on valid conclusions despite the prevalent issue of one-sided noncompliance.</p></div></section><section class="py-16 sm:py-20" id="problem"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center"><h2 class="text-3xl font-bold tracking-tight text-slate-800 sm:text-4xl">Who Are the People in Our Study?</h2><p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">Deviations are not arbitrary. To analyze their impact, we categorize individuals into unseen clusters based on their reactions to specific tasks. This method is termed **Principal Stratification**.</p></div><div class="mt-12"><div class="flex justify-center items-center space-x-4 mb-8"><span class="text-slate-600 font-medium">Standard Experiment</span><label class="relative inline-flex items-center cursor-pointer" for="noncomplianceToggle"><input class="sr-only peer" id="noncomplianceToggle" type="checkbox" value=""/><div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></label><span class="text-slate-600 font-medium">One-Sided Noncompliance</span></div><p class="text-center text-slate-500 mb-10 -mt-4 transition-opacity duration-500 opacity-0" id="toggle-description">If treatment access is denied to the control group due to one-sided noncompliance, this removes Always-Takers and Defiers.</p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-7xl mx-auto"><div class="strata-card stat-card text-center" id="strata-complier"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 text-green-600 text-2xl font-bold">✓</div><h3 class="mt-5 text-lg font-semibold text-slate-800">Compliers</h3><p class="mt-2 text-slate-500">Adhere to the assigned treatment; their actions mirror this allocation.</p></div><div class="strata-card stat-card text-center" id="strata-never"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 text-red-600 text-2xl font-bold">✗</div><h3 class="mt-5 text-lg font-semibold text-slate-800">Never-Takers</h3><p class="mt-2 text-slate-500">Will not take the treatment, regardless of their assignment.</p></div><div class="strata-card stat-card text-center" id="strata-always"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 text-yellow-600 text-2xl font-bold">!</div><h3 class="mt-5 text-lg font-semibold text-slate-800">Always-Takers</h3><p class="mt-2 text-slate-500">Will always take the treatment, regardless of their assignment.</p></div><div class="strata-card stat-card text-center" id="strata-defier"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-purple-100 text-purple-600 text-2xl font-bold">?</div><h3 class="mt-5 text-lg font-semibold text-slate-800">Defiers</h3><p class="mt-2 text-slate-500">Defy their purpose. They're typically nonexistent.</p></div></div></div></section><section class="py-16 sm:py-20 bg-white" id="framework"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center"><h2 class="text-3xl font-bold tracking-tight text-slate-800 sm:text-4xl">The Analytical Toolkit</h2><p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">To gauge a causal impact with noncompliance present, well-defined assumptions and a specific target for measurement are crucial.</p></div><div class="mt-12 max-w-4xl mx-auto"><div class="border-b border-slate-200"><nav aria-label="Tabs" class="-mb-px flex space-x-6"><div class="tab active" id="tab-assumptions">Assumptions</div><div class="tab" id="tab-estimands">Estimands</div></nav></div><div class="mt-8"><div class="tab-content active space-y-6" id="content-assumptions"><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Non-Interference (SUTVA)</h4><p class="text-slate-600 mt-1">Here are a few ways to rewrite the line, maintaining a similar size and conveying the same meaning (no spillover effects):

*   **Treatment assigned to others doesn't impact an individual's result.**
*   **A person's experience isn't influenced by how others are treated.**
*   **Each person's outcome is independent of others' assigned treatments.**
*   **No one's results are changed by the treatment of anyone else.**</p></div><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Exclusion Restriction</h4><p class="text-slate-600 mt-1">Treatment *allocation* influences outcome solely by changing *treatment uptake*. Being assigned something (like a letter) alone has no direct impact on those who decline treatment.</p></div><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Monotonicity</h4><p class="text-slate-600 mt-1">No "Defiers" exist. Treatment assignment cannot decrease uptake; this is inherent to one-sided noncompliance studies.</p></div></div><div class="tab-content space-y-6" id="content-estimands"><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Intention-to-Treat (ITT)</h4><p class="text-slate-600 mt-1">Focusing on **offered** treatment's impact, irrespective of uptake. Addresses a policy goal: assessing the "program's offer effect," through a straightforward group comparison.</p></div><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Complier Average Causal Effect (CACE)</h4><p class="text-slate-600 mt-1">Focusing on Compliers: What happened when they *actually* got treatment? This addresses: "For those who took it when offered, what was the impact?" Defined as the Local Average Treatment Effect (LATE).</p></div><div class="p-5 border rounded-lg bg-slate-50"><h4 class="font-semibold text-slate-800">Average Treatment Effect (ATE)</h4><p class="text-slate-600 mt-1">The average treatment effect across the entire population, an ideal scenario, is **unidentifiable** when there's noncompliance, particularly for those who consistently refuse treatment.</p></div></div></div></div></div></section><section class="py-16 sm:py-20" id="solution"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center"><h2 class="text-3xl font-bold tracking-tight text-slate-800 sm:text-4xl">Interactive Solution: The Wald Estimator</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">Let's illustrate with the Sommer &amp; Zeger (1991) study on Vitamin A supplements and child mortality, aiming to pinpoint the causal effect of the Vitamin A supplement (CACE).</p></div><div class="mt-12 max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-start"><div class="space-y-8"><div class="stat-card"><h3 class="font-semibold text-slate-800">Study Data</h3><div class="mt-4 grid grid-cols-2 gap-4 text-sm text-slate-600"><div><span class="font-medium text-slate-800">Assigned Treatment (Z=1):</span> 12,094 children</div><div><span class="font-medium text-slate-800">Assigned Control (Z=0):</span> 11,588 children</div><div><span class="font-medium text-slate-800">Received Treatment (W=1) in Z=1:</span> 9,675</div><div><span class="font-medium text-slate-800">Deaths in Z=1 Group:</span> 46</div><div><span class="font-medium text-slate-800">Received Treatment (W=1) in Z=0:</span> 0 (One-sided)</div><div><span class="font-medium text-slate-800">Deaths in Z=0 Group:</span> 74</div></div></div><div class="stat-card"><h3 class="font-semibold text-slate-800">The CACE Formula (Wald Estimator)</h3><p class="mt-2 text-slate-600">The CACE is calculated by dividing the ITT effect on the outcome (ITT_Y) by the ITT effect on treatment uptake (ITT_W), essentially the compliance rate.</p><div class="mt-4 text-center text-xl p-4 bg-slate-100 rounded-lg font-mono text-slate-700">
                                CACE = 
                                <span class="tooltip"><span class="text-blue-600">ITT<sub class="font-sans">Outcome</sub></span><span class="tooltiptext">Effect of assignment on the outcome (mortality).</span></span> 
                                / 
                                <span class="tooltip"><span class="text-green-600">ITT<sub class="font-sans">Treatment</sub></span><span class="tooltiptext">Effect of assignment on take-up (the compliance rate).</span></span></div></div><div class="stat-card"><h3 class="font-semibold text-slate-800">Calculated Effects</h3><div class="mt-4 space-y-4" id="results"><div class="flex justify-between items-center"><span class="text-slate-600 font-medium">ITT (Outcome):</span><span class="font-bold text-lg text-blue-600" id="itt_y_result"></span></div><div class="flex justify-between items-center"><span class="text-slate-600 font-medium">Compliance Rate (ITT_W):</span><span class="font-bold text-lg text-green-600" id="itt_w_result"></span></div><hr class="my-2"/><div class="flex justify-between items-center"><span class="text-slate-800 font-semibold text-lg">CACE:</span><span class="font-bold text-2xl text-slate-800" id="cace_result"></span></div></div></div></div><div class="space-y-8"><div><h4 class="text-center font-medium text-slate-700 mb-2">Mortality Rate by Assignment (ITT)</h4><div class="chart-container"><canvas id="ittChart"></canvas></div></div><div><h4 class="text-center font-medium text-slate-700 mb-2">Treatment Take-up Rate (Compliance)</h4><div class="chart-container"><canvas id="complianceChart"></canvas></div></div></div></div></div></section><section class="py-16 sm:py-20 bg-white" id="pitfalls"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center"><h2 class="text-3xl font-bold tracking-tight text-slate-800 sm:text-4xl">Common Analytical Pitfalls</h2><p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">Failing to address noncompliance with care skews results significantly. Steering clear of these pitfalls is vital.</p></div><div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto"><div class="border-2 border-red-500 rounded-lg p-6 bg-red-50"><h3 class="text-lg font-semibold text-red-800">DON'T: As-Treated or Per-Protocol Analysis</h3><p class="mt-3 text-red-700">This strategy bypasses the initial random allocation, opting to compare all treated individuals against the untreated, or to exclude those who didn't fully adhere to their assigned group.
                        <br/><br/><strong>Why it's wrong:</strong> This defeats randomization! Groups become incomparable; compliance choices link to outcomes. This creates **selection bias**. The "healthy adherer" effect exemplifies this: placebo takers fare better, not due to the placebo, but because they're intrinsically healthier or more compliant.
                        </p></div><div class="border-2 border-green-500 rounded-lg p-6 bg-green-50"><h3 class="text-lg font-semibold text-green-800">DO: Intention-to-Treat (ITT) &amp; CACE</h3><p class="mt-3 text-green-700">Begin with the Intent-to-Treat (ITT) analysis, as it preserves initial randomization. This provides an unbiased assessment of the *program's* impact.
                        <br/><br/>
                        Assuming the conditions are met (particularly the exclusion restriction), employ an instrumental variable method (e.g., the Wald estimator) to estimate the CACE. This provides an unbiased estimate of the *treatment* effect specifically for the Compliers group.
                        </p></div></div></div></section><section class="py-16 sm:py-20" id="design"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="text-center"><h2 class="text-3xl font-bold tracking-tight text-slate-800 sm:text-4xl">Design in Anticipation of Noncompliance</h2><p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">Flawless analysis is futile with flawed experiments. Strategic design is crucial for strong results, ensuring both trustworthiness and adherence to protocol.</p></div><div class="mt-12 max-w-4xl mx-auto space-y-8"><div class="stat-card"><h3 class="font-semibold text-slate-800">Strategies to Maximize Compliance</h3><ul class="mt-3 list-disc list-inside text-slate-600 space-y-2"><li><strong>Simplify the Intervention:</strong> Make participation as easy and low-cost as possible.</li><li><strong>Use Behavioral Nudges:</strong> Employ reminders, clear messaging, and effective framing to encourage take-up.</li><li><strong>Educate and Communicate:</strong> Ensure participants understand the protocol and its benefits. Build trust.</li></ul></div><div class="stat-card"><h3 class="font-semibold text-slate-800">Designing for a Credible Analysis</h3><ul class="mt-3 list-disc list-inside text-slate-600 space-y-2"><li><strong>Strengthen the Exclusion Restriction:</strong> Employ placebos and double-blinding techniques whenever feasible to neutralize direct impacts from the assignment process.</li><li><strong>Use Encouragement Designs Carefully:</strong> When using encouragement, avoid introducing extraneous information that could sway results on its own.</li><li><strong>Measure Key Covariates:</strong> Here are a few options for rewriting the line, all similar in length and focusing on clarity:

*   **Gather initial data to identify factors influencing adherence and results, refining accuracy and defining the Complier group.**
*   **Establish a starting dataset to predict compliance and outcomes, optimizing accuracy and profiling the Complier cohort.**
*   **Obtain baseline measurements of predictors for compliance and outcomes, enhancing precision and characterizing the Complier subgroup.**
*   **Analyze preliminary data on predictors for adherence and results; this will refine precision and define the Complier group.**</li></ul></div></div></div></section></main><html><head></head><body><footer class="bg-gray-800 text-gray-300"><div class="container mx-auto px-6 py-12 lg:px-8"><div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-4"><div><h5 class="text-lg font-semibold text-white mb-4">Company</h5><ul class="space-y-2"><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/about-dataknobs/">About Us</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/products/value-proposition/">Value Proposition</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/blog/">Blog</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/use-cases/">Use Cases Built</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/about-dataknobs/leadership/">Founder</a></li></ul></div><div><h5 class="text-lg font-semibold text-white mb-4">Products</h5><ul class="space-y-2"><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/products/kreate/">Kreate</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/products/kontrols/">Kontrols</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/products/knobs/">Knobs</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/use-cases/">Case Studies</a></li></ul></div><div><h5 class="text-lg font-semibold text-white mb-4">Slides Tutorials</h5><ul class="space-y-2"><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/generativeai/generative-ai-101-slides.html">GenAI Slides</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/agent-ai/tutorials.html">Agent AI Slides</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/vector-database/">Vector DB Slides</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/generativeai/10-llms/">LLM Slides</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/data-products/">Data Product Slides</a></li><li><a class="hover:text-white hover:underline transition-colors duration-200" href="https://www.dataknobs.com/generativeai/10-llms/rag/">RAG Slides</a></li></ul></div><div><h5 class="text-lg font-semibold text-white mb-4">Contact Us</h5><div class="space-y-2"><p>Redmond<br/>WA, USA</p><p><a class="hover:text-white hover:underline transition-colors duration-200" href="mailto:contact@dataknobs.com">contact@dataknobs.com</a></p><p><a class="hover:text-white hover:underline transition-colors duration-200" href="tel:+14253411222">+1 (425) 341-1222</a></p></div></div></div><div class="mt-12 border-t border-gray-700 pt-8 flex flex-col items-center justify-between sm:flex-row"><p class="text-sm text-gray-400">© 2025 Dataknobs, Inc. All rights reserved.</p><div class="flex space-x-4 mt-4 sm:mt-0"><a class="text-gray-400 hover:text-white transition-colors duration-200" href="https://www.facebook.com/dataknobs/"><span class="sr-only">Facebook</span><svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path clip-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.772-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" fill-rule="evenodd"></path></svg></a><a class="text-gray-400 hover:text-white transition-colors duration-200" href="https://www.twitter.com/dataknobs/"><span class="sr-only">Twitter</span><svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a class="text-gray-400 hover:text-white transition-colors duration-200" href="https://www.linkedin.com/company/dataknobs/"><span class="sr-only">LinkedIn</span><svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path clip-rule="evenodd" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.783-1.75-1.75s.784-1.75 1.75-1.75 1.75.783 1.75 1.75-.784 1.75-1.75 1.75zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" fill-rule="evenodd"></path></svg></a></div></div></div></footer></body></html><script>
        document.addEventListener('DOMContentLoaded', function() {
            const noncomplianceToggle = document.getElementById('noncomplianceToggle');
            const toggleDescription = document.getElementById('toggle-description');
            const alwaysCard = document.getElementById('strata-always');
            const defierCard = document.getElementById('strata-defier');

            noncomplianceToggle.addEventListener('change', function() {
                const isDisabled = this.checked;
                alwaysCard.classList.toggle('disabled', isDisabled);
                defierCard.classList.toggle('disabled', isDisabled);
                toggleDescription.style.opacity = isDisabled ? '1' : '0';
            });

            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.id.replace('tab-', 'content-');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === targetId) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            const data = {
                z1_n: 12094,
                z0_n: 11588,
                z1_w1: 9675,
                z0_w1: 0,
                z1_deaths: 46,
                z0_deaths: 74,
            };

            const mort_rate_z1 = data.z1_deaths / data.z1_n;
            const mort_rate_z0 = data.z0_deaths / data.z0_n;
            const itt_y = mort_rate_z1 - mort_rate_z0;

            const takeup_rate_z1 = data.z1_w1 / data.z1_n;
            const takeup_rate_z0 = data.z0_w1 / data.z0_n;
            const itt_w = takeup_rate_z1 - takeup_rate_z0;

            const cace = itt_y / itt_w;

            document.getElementById('itt_y_result').textContent = (itt_y * 100).toFixed(3) + ' pp';
            document.getElementById('itt_w_result').textContent = (itt_w * 100).toFixed(1) + '%';
            document.getElementById('cace_result').textContent = (cace * 100).toFixed(3) + ' pp';

            const formatPercentage = (value) => (value * 100).toFixed(2) + '%';
            
            new Chart(document.getElementById('ittChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Assigned Control', 'Assigned Treatment'],
                    datasets: [{
                        label: 'Mortality Rate',
                        data: [mort_rate_z0, mort_rate_z1],
                        backgroundColor: ['#fca5a5', '#60a5fa'],
                        borderColor: ['#ef4444', '#3b82f6'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { callback: value => formatPercentage(value) }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (context) => formatPercentage(context.raw) } }
                    }
                }
            });

            new Chart(document.getElementById('complianceChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Assigned Control', 'Assigned Treatment'],
                    datasets: [{
                        label: 'Take-up Rate',
                        data: [takeup_rate_z0, takeup_rate_z1],
                        backgroundColor: ['#fca5a5', '#4ade80'],
                        borderColor: ['#ef4444', '#22c55e'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            max: 1,
                            ticks: { callback: value => formatPercentage(value) } 
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: (context) => formatPercentage(context.raw) } }
                    }
                }
            });
        });
    </script></body></html>